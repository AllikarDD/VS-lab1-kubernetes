# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 4

## –ó–∞–¥–∞—á–∞

–ü–æ–¥–Ω—è—Ç—å StatefulSet –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å PostgreSQL. –°–æ–∑–¥–∞—Ç—å Service, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ PostgreSQL –ø–æ DNS –∏–º–µ–Ω–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ —Ç–∞–∫ –∂–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–∑ Secret –∏ ConfigMap, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Volume, —á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø—Ä–æ–ø–∞–¥–∞–ª–∏ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–¥—ã. –°–æ–±—Ä–∞—Ç—å Deployment —Å –Ω–∞—à–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º –Ω–∞ GO, –∞ —Ç–∞–∫ –∂–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–∑ Secret –∏ ConfigMap

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–±—Ä–∞–∑–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ GO

1. <span id="20250526223708-nbnqp3p" style="display: none;"></span>–ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–¥(–Ω–∏–∂–µ) –∏–∑ —Ñ–∞–π–ª–∞ `lab4/main.go`‚Äã —Ç–∞–∫, —á—Ç–æ–±—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π const –±—Ä–∞–ª–∏—Å—å –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–∞–∑–≤–∞–Ω–∏—è –º–æ–∂–µ—Ç–µ –≤—ã–±—Ä–∞—Ç—å —Å–∞–º–∏ üòè).

```go
const (
    host     = "postgres-service"
    port     = 5432
    user     = "dbuser"
    password = "dbpassword"
    dbname   = "mydatabase"
)
```

2. –°–æ–∑–¥–∞–π—Ç–µ –æ–±—Ä–∞–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–µ `lab4/main.go`‚Äã –∫–æ–º–∞–Ω–¥–æ–π

```bash
docker image build -t mypostgessapp .
```

## 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –¥–ª—è postgres

1. –°–æ–∑–¥–∞–π—Ç–µ StatefulSet –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å postgres –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

```yaml
# postgres-statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgres
spec:
  serviceName: postgres-service
  replicas: 1
  selector:
    matchLabels:
      app: postgres
  template:
    metadata:
      labels:
        app: postgres
    spec:
      containers:
      - name: postgres
        image: postgres:13
        env:
        - name: POSTGRES_USER
          value: dbuser
        - name: POSTGRES_PASSWORD
          value: dbpassword
        - name: POSTGRES_DB
          value: mydatabase
        ports:
        - containerPort: 5432
```

2. –°–æ–∑–¥–∞–π—Ç–µ Secret –¥–ª—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è POSTGRES_USER –∏ –ø–∞—Ä–æ–ª—è –∫ –ë–î POSTGRES_PASSWORD

3. –ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–¥ –≤—ã—à–µ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è POSTGRES_USER –∏ POSTGRES_PASSWORD –±—Ä–∞–ª–∏—Å—å –∏–∑ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞

4. –°–æ–∑–¥–∞–π—Ç–µ ConfigMap –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è –ë–î POSTGRES_DB

5. –ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–¥ –≤—ã—à–µ, —á—Ç–æ–±—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è POSTGRES_DB –±—Ä–∞–ª–∏—Å—å –∏–∑ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥–º–∞–ø—ã

6. –ò–∑–º–µ–Ω–∏—Ç–µ –∫–æ–¥ –≤—ã—à–µ

    1. –î–æ–±–∞–≤—å—Ç–µ `volumeClaimTemplates`‚Äã –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö
    2. –î–æ–±–∞–≤—å—Ç–µ `volumeMounts`‚Äã –≤ –∫–æ–Ω—Ç–µ–Ω–µ—Ä —Å –ø—É—Ç—ë–º –¥–ª—è –ø–∞–ø–∫–∏ `mountPath: /var/lib/postgresql/data`‚Äã

7. –°–æ–∑–¥–∞–π—Ç–µ –º–∞–Ω–∏—Ñ–µ—Å—Ç `Service`‚Äã —Å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ–º –Ω–∞ –ø–æ—Ä—Ç 5432 –¥–ª—è StatefulSet, —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ —Ä–∞–Ω–µ–µ.
```yaml
  ports:
    - port: 5432
      targetPort: 5432

```

8. –í—ã–ø–æ–ª–Ω–∏—Ç–µ

```bash
kubectl get pods
```

‚Äç

9. –ó–∞–π–¥–∏—Ç–µ –≤ –ø–æ–¥—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è postgres

```bash
kubectl exec -it postgres-0 -- /bin/bash
```

10. –ü–æ–¥–ª—é—á–∏–º—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã psql –∏ —Å–æ–∑–¥–∞–¥–∏–º —Ç–∞–±–ª–∏—Ü—É Products.

–î–ª—è —ç—Ç–æ–≥–æ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –Ω–∏–∂–µ, –≤ –∫–∞—á–µ—Å—Ç–≤–µ dbuser –∏ mydatabase —É–∫–∞–∂–∏—Ç–µ —Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —É–∫–∞–∑–∞–ª–∏ –≤ ConfigMap, –µ—Å–ª–∏ –≤—ã –∏—Ö –º–µ–Ω—è–ª–∏:

```bash
psql -U dbuser -d mydatabase -c " CREATE TABLE Products ( id    integer PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY, model  varchar(30) NOT NULL, company varchar(30) NOT NULL, price integer NOT NULL);"
```

11. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –µ—Å—Ç—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ

```bash
psql -U dbuser -d mydatabase -c "select * from Products"
```

## 3. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–∞–Ω–∏—Ñ–µ—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è mypostgessapp

1. –°–æ–∑–¥–∞–π—Ç–µ `Deployment`‚Äã —Å –æ–±—Ä–∞–∑–æ–º `mypostgessapp`‚Äã (–Ω–µ –∑–∞–±—É–¥—å—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É `imagePullPolicy: Never`‚Äã, —á—Ç–æ–±—ã –±—ã–ª –¥–æ—Å—Ç—É–ø –¥–æ –≤–∞—à–µ–≥–æ –æ–±—Ä–∞–∑–∞)

2. –î–æ–±–∞–≤—å—Ç–µ, —á—Ç–æ–±—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `mypostgessapp`‚Äã –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å—Ä–µ–¥—ã (—Å–æ–∑–¥–∞–Ω–Ω—ã–µ –≤ –ø—É–Ω–∫—Ç–µ [–ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–¥(–Ω–∏–∂–µ) –∏–∑ —Ñ–∞–π–ª–∞ lab4/main.go —Ç–∞–∫, —á—Ç–æ–±—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π const –±—Ä–∞–ª–∏—Å—å –∏–∑ –ø–µ....](#20250526223708-nbnqp3p)) –∏–∑ —Å–µ–∫—Ä–µ—Ç–∞ –∏ –∫–æ–Ω—Ñ–∏–≥–º–∞–ø—ã —Å–æ–∑–¥–∞–Ω—ã—Ö —Ä–∞–Ω–µ–µ

    1. –î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥–º–∞–ø—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

        1. ‚Äã`host`‚Äã - DNS –∏–º—è, –∫–æ—Ç–æ—Ä–æ–µ –º—ã —Å–∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞–ª–∏ —Å –ø–æ–º–æ—â—å—é –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ Service
        2. ‚Äã`port`‚Äã - –ø–æ—Ä—Ç –¥–ª—è –ø–æ—Å—Ç–≥—Ä–µ—Å—Å 5432

## 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. –ó–∞–π–¥–∏—Ç–µ –≤ –ø–æ–¥—É postgres –∏ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ Products

```bash
kubectl exec -it postgres-0 -- /bin/bash
```

```bash
psql -U dbuser -d mydatabase -c "select * from Products"
```

2. –£–¥–∞–ª–∏—Ç–µ –ø–æ–¥—É postgres, –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–æ–ø–∞–ª–∏ –ª–∏ –¥–∞–Ω–Ω—ã–µ
